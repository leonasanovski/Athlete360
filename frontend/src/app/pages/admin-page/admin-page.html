<div class="container admin-page p-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="mb-0">Pending Users</h3>
    <button class="btn btn-primary btn-sm" (click)="onLogout()">Sign Out</button>
  </div>

  <div class="row mb-3 g-3">
    <div class="col-md-6">
      <input #searchInput class="form-control shadow-sm rounded" placeholder="Search by EMBG" (input)="onSearch(searchInput.value)" />
    </div>
    <div class="col-md-6 text-md-end">
      <button class="btn btn-outline-secondary btn-sm shadow-sm" (click)="toggleSort()">Sort by Created At</button>
    </div>
  </div>

  <div class="table-responsive shadow-sm rounded bg-white p-3">
    <table class="table table-borderless table-hover align-middle mb-0">
      <thead class="table-light">
      <tr>
        <th>EMBG</th>
        <th>First</th>
        <th>Last</th>
        <th>Email</th>
        <th>Created At</th>
        <th>Role</th>
        <th class="text-end">Actions</th>
      </tr>
      </thead>
      <tbody>
        @for (u of users; track u.userId) {
          <tr class="align-middle">
            <td>{{ u.embg }}</td>
            <td>{{ u.firstName }}</td>
            <td>{{ u.lastName }}</td>
            <td>{{ u.email || '-' }}</td>
            <td>{{ u.createdAt ? (u.createdAt | date: 'short') : '-' }}</td>
            <td>
              <select class="form-select form-select-sm shadow-sm" [ngModel]="u.role" (ngModelChange)="onRoleChange(u, $event)">
                <option value="PATIENT">PATIENT</option>
                <option value="DOCTOR">DOCTOR</option>
                <option value="PENDING">PENDING</option>
              </select>
            </td>
            <td class="text-end">
              <button class="btn btn-outline-danger btn-sm shadow-sm" (click)="confirmAndDelete(u)" title="Delete">
                <i class="bi bi-trash"></i>
              </button>
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>

  @if (totalPages > 1) {
    <nav class="mt-4 d-flex justify-content-center">
      <ul class="pagination pagination-sm shadow-sm rounded">
        <li class="page-item" [class.disabled]="page === 0">
          <a class="page-link">Previous</a>
        </li>
        @for (p of [].constructor(totalPages); track p.id; let i = $index) {
          <li class="page-item" [class.active]="i === page">
            <a class="page-link">{{ i + 1 }}</a>
          </li>
        }
        <li class="page-item" [class.disabled]="page >= totalPages - 1">
          <a class="page-link">Next</a>
        </li>
      </ul>
    </nav>
  }
</div>
